<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>PEROPLUS - Sistema Unificado Melhorado</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #eef2f7;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }
    .container {
      background: white;
      border-radius: 12px;
      padding: 30px 40px;
      max-width: 450px;
      width: 100%;
      box-shadow: 0 0 18px rgba(0,0,0,0.1);
      text-align: center;
    }
    h2 {
      margin-bottom: 25px;
      color: #333;
    }
    input {
      width: 90%;
      padding: 14px;
      margin: 12px 0;
      border-radius: 8px;
      border: 1px solid #bbb;
      font-size: 16px;
      transition: border-color 0.3s;
    }
    input:focus {
      border-color: #007bff;
      outline: none;
    }
    button {
      width: 95%;
      padding: 14px;
      margin-top: 20px;
      background-color: #007bff;
      color: white;
      font-weight: 700;
      font-size: 18px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #0056b3;
    }
    .toggle-btn {
      background: none;
      color: #007bff;
      border: none;
      cursor: pointer;
      text-decoration: underline;
      margin-top: 18px;
      font-size: 15px;
    }
    .hidden {
      display: none;
    }
    .painel {
      display: flex;
      flex-direction: column;
      gap: 18px;
      margin-top: 20px;
      text-align: left;
    }
    .painel button, .painel a {
      background: #f0f4ff;
      border-radius: 10px;
      padding: 12px 20px;
      font-weight: 600;
      color: #007bff;
      text-align: left;
      border: 2px solid transparent;
      cursor: pointer;
      text-decoration: none;
      font-size: 16px;
      transition: background-color 0.3s, border-color 0.3s;
    }
    .painel button:hover, .painel a:hover {
      background: #d9e2ff;
      border-color: #007bff;
    }
    .logout {
      margin-top: 25px;
      color: #d33;
      font-weight: 700;
      cursor: pointer;
      border: none;
      background: none;
      font-size: 16px;
      text-align: center;
    }
    .info-box {
      background: #e7f0ff;
      border: 1px solid #aad1ff;
      padding: 15px 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      color: #0553b5;
      font-weight: 600;
      font-size: 16px;
    }
    .reward-msg {
      background: #d4f5d4;
      border: 1px solid #7ed67e;
      color: #2b7a2b;
      padding: 12px 18px;
      border-radius: 8px;
      margin-top: 12px;
      font-weight: 700;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- Registro -->
    <div id="registerSection">
      <h2>üìù Registo - PEROPLUS</h2>
      <form id="registerForm">
        <input type="text" id="nome" placeholder="Nome completo" required />
        <input type="tel" id="telefone" placeholder="Telefone (apenas n√∫meros)" required />
        <input type="password" id="senha" placeholder="Senha" required minlength="4" />
        <input type="text" id="codigo" placeholder="C√≥digo de convite (opcional)" />
        <button type="submit">Criar Conta</button>
      </form>
      <button class="toggle-btn" onclick="mostrarLogin()">J√° tens conta? Entrar</button>
    </div>

    <!-- Login -->
    <div id="loginSection" class="hidden">
      <h2>üîê Entrar - PEROPLUS</h2>
      <form id="loginForm">
        <input type="tel" id="loginTelefone" placeholder="Telefone" required />
        <input type="password" id="loginSenha" placeholder="Senha" required />
        <button type="submit">Entrar</button>
      </form>
      <button class="toggle-btn" onclick="mostrarRegisto()">Criar conta</button>
    </div>

    <!-- Painel -->
    <div id="painelSection" class="hidden">
      <h2>üëã Ol√°, <span id="nomeUsuario"></span>!</h2>
      <div class="info-box">
        Saldo atual: <strong id="saldoUsuario">0.00</strong> Mts
      </div>

      <div class="info-box" id="convidadosInfo">
        Voc√™ convidou <strong id="numConvidados">0</strong> pessoa(s).
      </div>

      <div id="rewardMessage" class="reward-msg hidden"></div>

      <div class="painel">
        <button onclick="simularRecarga()">üí∞ Fazer Recarga</button>
        <button onclick="verHistorico()">üìú Ver Hist√≥rico</button>
        <button onclick="verConvidados()">üë• Meus Convidados</button>
      </div>

      <button class="logout" onclick="logout()">üö™ Sair</button>
    </div>

  </div>

<script>
  const regForm = document.getElementById('registerForm');
  const loginForm = document.getElementById('loginForm');

  const registerSection = document.getElementById('registerSection');
  const loginSection = document.getElementById('loginSection');
  const painelSection = document.getElementById('painelSection');

  const nomeUsuario = document.getElementById('nomeUsuario');
  const saldoUsuario = document.getElementById('saldoUsuario');
  const numConvidados = document.getElementById('numConvidados');
  const rewardMessage = document.getElementById('rewardMessage');

  function mostrarLogin() {
    registerSection.classList.add('hidden');
    loginSection.classList.remove('hidden');
    painelSection.classList.add('hidden');
    clearForms();
  }

  function mostrarRegisto() {
    loginSection.classList.add('hidden');
    registerSection.classList.remove('hidden');
    painelSection.classList.add('hidden');
    clearForms();
  }

  function mostrarPainel(user) {
    registerSection.classList.add('hidden');
    loginSection.classList.add('hidden');
    painelSection.classList.remove('hidden');
    nomeUsuario.textContent = user.nome;
    saldoUsuario.textContent = parseFloat(user.saldo || 0).toFixed(2);

    // Conta convidados
    const convidados = buscarConvidados(user.telefone);
    numConvidados.textContent = convidados.length;

    // Exibir recompensa
    mostrarRecompensa(convidados.length);
  }

  function clearForms() {
    regForm.reset();
    loginForm.reset();
  }

  // Busca convidados que usaram o c√≥digo do usu√°rio
  function buscarConvidados(codigoUsuario) {
    const convidados = [];
    for (let i = 0; i < localStorage.length; i++) {
      const key = localStorage.key(i);
      if (key.startsWith('user_')) {
        const user = JSON.parse(localStorage.getItem(key));
        if (user.codigo === codigoUsuario) {
          convidados.push(user);
        }
      }
    }
    return convidados;
  }

  function mostrarRecompensa(qtdConvidados) {
    if (qtdConvidados >= 5) {
      rewardMessage.textContent = "üéâ Parab√©ns! Voc√™ atingiu a meta de 5 convidados e ganhou um b√¥nus extra!";
      rewardMessage.classList.remove('hidden');
    } else {
      rewardMessage.textContent = "";
      rewardMessage.classList.add('hidden');
    }
  }

  // Registro
  regForm.addEventListener('submit', e => {
    e.preventDefault();
    const nome = document.getElementById('nome').value.trim();
    const telefone = document.getElementById('telefone').value.trim();
    const senha = document.getElementById('senha').value;
    const codigo = document.getElementById('codigo').value.trim();

    if (!/^\d{8,}$/.test(telefone)) {
      alert("Telefone inv√°lido. Deve conter pelo menos 8 d√≠gitos.");
      return;
    }
    if (senha.length < 4) {
      alert("Senha muito curta (m√≠nimo 4 caracteres).");
      return;
    }
    if (localStorage.getItem('user_' + telefone)) {
      alert("Telefone j√° registado.");
      return;
    }

    const user = { nome, telefone, senha, codigo, saldo: 0 };
    localStorage.setItem('user_' + telefone, JSON.stringify(user));
    localStorage.setItem('login_telefone', telefone);
    mostrarPainel(user);
    clearForms();
  });

  // Login
  loginForm.addEventListener('submit', e => {
    e.preventDefault();
    const telefone = document.getElementById('loginTelefone').value.trim();
    const senha = document.getElementById('loginSenha').value;
    const user = JSON.parse(localStorage.getItem('user_' + telefone));

    if (user && user.senha === senha) {
      localStorage.setItem('login_telefone', telefone);
      mostrarPainel(user);
      clearForms();
    } else {
      alert("Telefone ou senha incorretos.");
    }
  });

  // Painel a√ß√µes
  function logout() {
    localStorage.removeItem('login_telefone');
    location.reload();
  }

  function simularRecarga() {
    const telefone = localStorage.getItem('login_telefone');
    if (!telefone) return alert("Voc√™ precisa estar logado.");

    const user = JSON.parse(localStorage.getItem('user_' + telefone));
    const valor = prompt("Informe o valor da recarga (ex: 100):");
    const numValor = Number(valor);
    if (isNaN(numValor) || numValor <= 0) return alert("Valor inv√°lido.");

    user.saldo = (parseFloat(user.saldo) + numValor).toFixed(2);
    localStorage.setItem('user_' + telefone, JSON.stringify(user));
    saldoUsuario.textContent = user.saldo;

    // Salvar hist√≥rico simples
    let hist = JSON.parse(localStorage.getItem('hist_' + telefone) || '[]');
    hist.push({ tipo: "Recarga", valor: numValor, data: new Date().toLocaleString() });
    localStorage.setItem('hist_' + telefone, JSON.stringify(hist));
    alert(`Recarga de ${numValor.toFixed(2)} Mts conclu√≠da.`);
  }

  function verHistorico() {
    const telefone = localStorage.getItem('login_telefone');
    if (!telefone) return alert("Voc√™ precisa estar logado.");

    const hist = JSON.parse(localStorage.getItem('hist_' + telefone) || '[]');
    if (hist.length === 0) {
      alert("Nenhum hist√≥rico encontrado.");
      return;
    }

    let msg = "üìú Hist√≥rico:\n\n";
    hist.forEach((item, i) => {
      msg += `${i+1}. ${item.tipo} - ${item.valor} Mts em ${item.data}\n`;
    });
    alert(msg);
  }

  function verConvidados() {
    const telefone = localStorage.getItem('login_telefone');
    if (!telefone) return alert("Voc√™ precisa estar logado.");

    const convidados = buscarConvidados(telefone);
    if (convidados.length === 0) {
      alert("Voc√™ ainda n√£o convidou ningu√©m.");
      return;
    }

    let msg = "üë• Seus convidados:\n\n";
    convidados.forEach((u, i) => {
      msg += `${i+1}. ${u.nome} - ${u.telefone}\n`;
    });
    alert(msg);
  }

  // Ao carregar, verifica login salvo
  window.onload = () => {
    const telefoneLogado = localStorage.getItem('login_telefone');
    if (telefoneLogado) {
      const user = JSON.parse(localStorage.getItem('user_' + telefoneLogado));
      if (user) mostrarPainel(user);
      else mostrarLogin();
    } else {
      mostrarRegisto();
    }
  };
</script>
</body>
</html>
